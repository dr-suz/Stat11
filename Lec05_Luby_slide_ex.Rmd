---
title: "Lec05: Linear Models"
subtitle: "Stat41: Data Viz"
author: "Prof Amanda Luby"
institute: "Swarthmore College"
output:
  xaringan::moon_reader:
    css: xaringan-themer.css
    lib_dir: libs
    nature:
      highlightStyle: github
      highlightLines: true
      countIncrementalSlides: false
---
class: center, middle

```{r setup, include=FALSE}
library(countdown)
library(tidyverse)
library(xaringanthemer)
knitr::opts_chunk$set(warning = FALSE, message = FALSE)
options(htmltools.dir.version = FALSE)
```

# Today: 

(1) Announcements

(2) Survey

(3) Regression Refresher

(4) IJALM

(5) Project 2

---
# Announcements

Project01/Labs/Milestones: if you don't think you'll be able to get them in by **Tuesday**, please get in touch with me so we can figure out a plan to catch up

--

If you're confident about catching up, I trust you. 

--

If you DO start to worry, please let me know - I'm here to help! 

--

This week: I've included a few options for integrating work from the labs or your final project into the mini-project, so there's an option to scale back the workload a bit

--

Milestone 02: we will talk about tomorrow 

--

ggplot2 [cheat sheet](https://rstudio.com/resources/cheatsheets/)

---

# Survey

Please fill out this ["first week survey"](https://forms.gle/6Fi74BhDFvXMeyMi9) -- *some* groups will be switching around tomorrow, so I need this information! 

```{r, echo = FALSE}
countdown(minutes=3, color_text = "#F97B64")
```

---
# Regression Refresher

.pull-left[
Idea: draw a line through a scatterplot, but with math

--

Assumptions (LINE): 

* **L**inear Relationship
* **I**ndependent Observations
* **N**ormal Residuals
* **E**qual variance in Residuals 
]

.pull-right[
```{r echo=FALSE}
library(palmerpenguins)
penguins %>% 
  filter(species == "Adelie") %>%
  ggplot(., aes(x = bill_length_mm, y = bill_depth_mm)) +
  geom_point() + 
  geom_smooth(se = FALSE, method = "lm") +
  theme_xaringan() + 
  labs(x = "Bill Length (mm)",
       y = "Bill Depth (mm)",
       title = "Adelie Penguins Bill Length/Depth",
       caption = "Source: palmerpenguins")
```
]

---

# In groups: 

(1) How do you check each of these assumptions?

--

(2) What do you do if they're violated? 

--

(3) What are the necessary visualizations in a OLS regression analysis?

--

(4) Did any questions come up from reading?

---
class: center, middle, inverse

# Quick Check in

---

**L**inear Relationship:

.pull-left[
```{r adelie-linear-scatter, fig.show = 'hide'}
penguins %>% 
  filter(species == "Adelie") %>%
  ggplot(., aes(x = bill_length_mm, y = bill_depth_mm)) +
  geom_point() + 
  geom_smooth(se = FALSE, method = "lm") +
  theme_xaringan() + 
  labs(x = "Bill Length (mm)",
       y = "Bill Depth (mm)",
       title = "Adelie Penguins Bill Length/Depth",
       caption = "Source: palmerpenguins")
```  
]

.pull-right[
![](`r knitr::fig_chunk("adelie-linear-scatter", "png")`)
]

---
**I**ndependent Observations 

First, consider how data was collected: does order matter? Next, look at the *residuals* plotted against the *predictor* variable. We shouldn't be able to see any relationship

.pull-left[
```{r resid-by-x, fig.show = 'hide'}
library(tidymodels)
adelie = penguins %>%
  filter(species == "Adelie")

lm_mod = lm(bill_depth_mm ~ bill_length_mm, data = adelie)
lm_res = augment(lm_mod)
ggplot(lm_res, aes(x = bill_length_mm, y = .resid)) +
  geom_point() +
  theme_xaringan()
```  
]

.pull-right[
![](`r knitr::fig_chunk("resid-by-x", "png")`)
]

---
**N**ormal Residuals

If we look at the distribution of the residuals, it should be *symmetric*, *unimodal*, and roughly  *bell-shaped*

.pull-left[
```{r resid-hist, fig.show = 'hide'}
ggplot(lm_res, aes(x = .resid)) +
  geom_histogram(bins = 20, col = "white") +
  theme_xaringan()
```  
]

.pull-right[
![](`r knitr::fig_chunk("resid-hist", "png")`)
]

---
**E**qual variance in the residuals

In the residual by fitted values scatterplot, there should be no relationship

.pull-left[
```{r resid-fitted, fig.show = 'hide'}
ggplot(lm_res, aes(x = .fitted, y = .resid)) +
  geom_point() +
  theme_xaringan()
```  
]

.pull-right[
![](`r knitr::fig_chunk("resid-fitted", "png")`)
]

---

# IJALM 

(**I**t's **J**ust **A** **L**inear **M**odel)

--

If you can do a linear regression, you can do *all of the other* Stat011 methods. 

--

We'll do quick examples of the following tests using the `penguins` data, showing that they're all equivalent to a linear model 

--

* One-sample t-test

--

* Two-sample t-test

--

* ANOVA

--

If you want to read more, [this link](https://lindeloev.github.io/tests-as-linear/linear_tests_cheat_sheet.pdf) has further details and discusses additional methods.

---

# One-sample t-test

.pull-left[
$$H_0: \mu = 40$$ 
$$H_A: \mu \ne 40$$ 
]

.pull-right[
```{r, echo = FALSE}
ggplot(adelie, aes(x = species, y = bill_length_mm)) + 
  geom_jitter(width = .1) +
  geom_abline(intercept = 40, slope = 0, col = "darkred") +
  theme_xaringan() 
```
]

---

```{r}
t_res = t.test(adelie$bill_length_mm, mu = 40)
t_res
```


```{r}
lm_res = lm((bill_length_mm - 40) ~ 1, data = adelie)
tidy(lm_res)
```

---

# Two-sample t-test

Test the mean of *Chinstrap* `bill_length` compared to *Gentoo* `bill_length`
.pull-left[
$$H_0: \mu_1 = \mu_2$$ 
$$H_A: \mu_1 \ne \mu_2$$ 
]

.pull-right[
```{r, echo = FALSE}
chinstrap_gentoo = penguins %>%
  filter(species != "Adelie")

ggplot(chinstrap_gentoo, aes(x = species, y = bill_length_mm)) + 
  geom_jitter(width = .1) +
  theme_xaringan() 
```
]

---

```{r}
t_res = t.test(bill_length_mm ~ species, data = chinstrap_gentoo, var.equal = TRUE)
t_res
```


```{r}
lm_res = lm(bill_length_mm ~ species + 1, data = chinstrap_gentoo)
tidy(lm_res)
```

---
# ANOVA

Test whether *all 3* species of penguins have the same *flipper length*

.pull-left[
$$H_0: \mu_1 = \mu_2 = \mu_3$$ 
$$H_A: \text{at least one} \ne$$ 
]

.pull-right[
```{r, echo = FALSE}
ggplot(penguins, aes(x = species, y = flipper_length_mm)) + 
  geom_jitter(width = .1) +
  theme_xaringan() 
```
]

---
```{r}
aov_res = aov(flipper_length_mm ~ species, data = penguins)
summary(aov_res)
```
```{r}
lm_res = lm(flipper_length_mm ~ species, data = penguins)
summary(lm_res)
```
]

---
class: center, middle, inverse

# Questions?

---

# Project 2

The [project 2 prompt](http://www.swarthmore.edu/NatSci/aluby1/stat041/Projects/proj-2.html) is posted
